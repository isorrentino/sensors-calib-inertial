<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of start</title>
  <meta name="keywords" content="start">
  <meta name="description" content="Set the controlled motor obj.ctrledMotor in PWM control mode.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # src --><!-- menu.html @MotorPWMcontroller -->
<h1>start
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Set the controlled motor obj.ctrledMotor in PWM control mode.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [ ok ] = start( obj ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">Set the controlled motor obj.ctrledMotor in PWM control mode.
   Handle the coupled Motors keeping their control mode and state
   unchanged. If this is not supported by the YARP
   remoteControlBoardRemapper, emulate it. We can only emulate position
   control.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../src/@LowlevTauCtrlCalibrator/LowlevTauCtrlCalibrator.html" class="code" title="">LowlevTauCtrlCalibrator</a>	</li><li><a href="MotorPWMcontroller.html" class="code" title="">MotorPWMcontroller</a>	</li><li><a href="../../src/@RateThread/RateThread.html" class="code" title="">RateThread</a>	</li><li><a href="../../src/@RemoteControlBoardRemapper/waitMotionDone.html" class="code" title="function success = waitMotionDone(obj,timeout)">waitMotionDone</a>	Waits for last programmed joint position to be reached.</li><li><a href="../../src/@SensorDataYarpI/waitPortOpen.html" class="code" title="function [ ok ] = waitPortOpen( port,timeout )">waitPortOpen</a>	Waits for specified port to open.</li><li><a href="../../src/@Timers/Timers.html" class="code" title="">Timers</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [ ok ] = start( obj )</a>
0002 <span class="comment">%Set the controlled motor obj.ctrledMotor in PWM control mode.</span>
0003 <span class="comment">%   Handle the coupled Motors keeping their control mode and state</span>
0004 <span class="comment">%   unchanged. If this is not supported by the YARP</span>
0005 <span class="comment">%   remoteControlBoardRemapper, emulate it. We can only emulate position</span>
0006 <span class="comment">%   control.</span>
0007 
0008 <span class="keyword">if</span> obj.running
0009     ok = false;
0010     warning(<span class="string">'Position control emulator is running !!'</span>);
0011     <span class="keyword">return</span>;
0012 <span class="keyword">end</span>
0013 
0014 <span class="comment">% Get indices and current mode of coupled motors</span>
0015 [ok,modes] = obj.remCtrlBoardRemap.getJointsControlMode(obj.couplingMotorIdxes);
0016 obj.couplingPrevMode = modes{1}; <span class="comment">% All modes from a coupling are identical</span>
0017 
0018 <span class="comment">% Load sampling and timeout parameters</span>
0019 config = Init.load(<span class="string">'lowLevTauCtrlCalibratorDevConfig'</span>);
0020 
0021 <span class="keyword">if</span> (length(obj.couplingMotorIdxes) == 1)
0022     <span class="comment">% Simple case, no coupling. Set single motor to PWM control mode</span>
0023     ok = obj.remCtrlBoardRemap.setJointsControlMode(obj.couplingMotorIdxes,<span class="string">'pwmctrl'</span>);
0024 <span class="keyword">else</span>
0025     <span class="comment">% Processing depending on the mode</span>
0026     <span class="keyword">switch</span> obj.couplingPrevMode
0027         <span class="keyword">case</span> <span class="string">'ctrl'</span>
0028             <span class="comment">% Run the position control emulator</span>
0029             ok = obj.runPwmEmulPosCtrlMode(config.posCtrlEmulator.samplingPeriod,config.posCtrlEmulator.timeout);
0030         <span class="keyword">otherwise</span>
0031             warningMessage = [<span class="keyword">...</span>
0032                 <span class="string">'setMotorPWMcontrolMode: previous mode was %s. For that mode we '</span> <span class="keyword">...</span>
0033                 <span class="string">'don''t  support setting one single motor to PWM control while '</span> <span class="keyword">...</span>
0034                 <span class="string">'emulating the previous mode for the others!'</span>];
0035             warning(warningMessage,obj.couplingPrevMode);
0036             <span class="comment">% Set all coupled motors to PWM control mode</span>
0037             ok = obj.remCtrlBoardRemap.setJointsControlMode(obj.couplingMotorIdxes,<span class="string">'pwmctrl'</span>);
0038     <span class="keyword">end</span>
0039 <span class="keyword">end</span>
0040 
0041 <span class="comment">% Run the real-time plotter</span>
0042 ok = obj.runRealtimePlotter(config.plotterThread.samplingPeriod,config.plotterThread.timeout);
0043 <span class="comment">%ok = obj.runRealtimePidPlotter(config.plotterThread.samplingPeriod,config.plotterThread.timeout);</span>
0044 
0045 <span class="comment">% Controller is ready now</span>
0046 obj.controllerReady = true;
0047 
0048 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 10-Jul-2018 15:03:35 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>