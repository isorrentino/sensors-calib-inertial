<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of parabolafit_cals</title>
  <meta name="keywords" content="parabolafit_cals">
  <meta name="description" content="Fit a parabola using consistent algebraic least squares.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # src --><!-- ../menu.html utils --><!-- menu.html quadfit -->
<h1>parabolafit_cals
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>Fit a parabola using consistent algebraic least squares.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [p,mu] = parabolafit_cals(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Fit a parabola using consistent algebraic least squares.

 Input arguments:
 x,y;
    x and y coodinates of 2D points

 Output arguments:
 p:
    a 6-parameter vector of the algebraic parabola fit with
    p(1)*x^2 + p(2)*x*y + p(3)*y^2 + p(4)*x + p(5)*y + p(6) = 0

 References:
 Matthew Harker, Paul O'Leary and Paul Zsombor-Murray, &quot;Direct type-specific conic
    fitting and eigenvalue bias correction&quot;, Image and Vision Computing, 26:372-381,
    2008.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../src/@y/y.html" class="code" title="">y</a>	</li><li><a href="mpolyeig.html" class="code" title="function [X,e] = mpolyeig(T, sigma)">mpolyeig</a>	Eigenvalues and eigenvectors for matrix polynomial.</li><li><a href="parabolafit_directm.html" class="code" title="function theta = parabolafit_directm(M)">parabolafit_directm</a>	Direct least squares fitting of parabolas using a pre-processed scatter matrix.</li><li><a href="quad2dcovred.html" class="code" title="function C = quad2dcovred(varargin)">quad2dcovred</a>	Reduced-size noise covariance structure corresponding to a 2D quadratic function.</li><li><a href="quad2dfit_paramchk.html" class="code" title="function [x,y,sigma_x,sigma_y] = quad2dfit_paramchk(filename, varargin)">quad2dfit_paramchk</a>	Quadratic 2-D fitting parameter check.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="example_parabolafit.html" class="code" title="function example_parabolafit">example_parabolafit</a>	Demonstration of parabola fitting.</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [p,mu] = parabolafit_cals(varargin)</a>
0002 <span class="comment">% Fit a parabola using consistent algebraic least squares.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Input arguments:</span>
0005 <span class="comment">% x,y;</span>
0006 <span class="comment">%    x and y coodinates of 2D points</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Output arguments:</span>
0009 <span class="comment">% p:</span>
0010 <span class="comment">%    a 6-parameter vector of the algebraic parabola fit with</span>
0011 <span class="comment">%    p(1)*x^2 + p(2)*x*y + p(3)*y^2 + p(4)*x + p(5)*y + p(6) = 0</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% References:</span>
0014 <span class="comment">% Matthew Harker, Paul O'Leary and Paul Zsombor-Murray, &quot;Direct type-specific conic</span>
0015 <span class="comment">%    fitting and eigenvalue bias correction&quot;, Image and Vision Computing, 26:372-381,</span>
0016 <span class="comment">%    2008.</span>
0017 
0018 <span class="comment">% Copyright 2013 Levente Hunyadi</span>
0019 
0020 [x,<a href="../../../src/@y/y.html" class="code" title="">y</a>,sigma_x,sigma_y] = <a href="quad2dfit_paramchk.html" class="code" title="function [x,y,sigma_x,sigma_y] = quad2dfit_paramchk(filename, varargin)">quad2dfit_paramchk</a>(mfilename, varargin{:});
0021 
0022 <span class="comment">% normalize data</span>
0023 mx = mean(x);
0024 my = mean(<a href="../../../src/@y/y.html" class="code" title="">y</a>);
0025 sx = (max(x)-min(x))/2;  <span class="comment">% scaling for x</span>
0026 sy = (max(<a href="../../../src/@y/y.html" class="code" title="">y</a>)-min(<a href="../../../src/@y/y.html" class="code" title="">y</a>))/2;  <span class="comment">% scaling for y</span>
0027 dx = (x-mx)/sx;  <span class="comment">% normalized data point coordinates</span>
0028 dy = (<a href="../../../src/@y/y.html" class="code" title="">y</a>-my)/sy;
0029 sigma_x = sigma_x/sx;  <span class="comment">% scaling for sigma_x</span>
0030 sigma_y = sigma_y/sy;  <span class="comment">% scaling for sigma_y</span>
0031 
0032 <span class="comment">% translate hyperplane to pass through origin</span>
0033 Z = [dx.^2, dx.*dy, dy.^2, dx, dy];
0034 mZ = mean(Z);
0035 Z = bsxfun(@minus, Z, mZ);
0036 D = (Z'*Z) / size(Z,1);
0037 
0038 <span class="comment">% build covariance polynomial</span>
0039 angle = atan2(sigma_y, sigma_x);
0040 Psi = -<a href="quad2dcovred.html" class="code" title="function C = quad2dcovred(varargin)">quad2dcovred</a>(angle, x, <a href="../../../src/@y/y.html" class="code" title="">y</a>);
0041 Psi(:,:,1) = Psi(:,:,1) + D;
0042 
0043 <span class="comment">% find those eigenvalues whose eigenvector is real and finite</span>
0044 [~,e] = <a href="mpolyeig.html" class="code" title="function [X,e] = mpolyeig(T, sigma)">mpolyeig</a>(Psi);
0045 ix = abs(imag(e)) &lt; eps &amp; isfinite(e);
0046 e = e(ix);
0047 
0048 <span class="comment">% find eigenvalue with smallest magnitude that minimizes</span>
0049 <span class="comment">% theta' * (T(:,:,1) - mu*T(:,:,2) - mu^2*T(:,:,3)) * theta</span>
0050 [~,ix] = min(abs(e));
0051 mu = e(ix);
0052 
0053 <span class="comment">% covariance matrix with noise canceled</span>
0054 R = Psi(:,:,1) + mu*Psi(:,:,2) + mu^2*Psi(:,:,3);
0055 
0056 S1 = R(1:3,1:3);  <span class="comment">% quadratic part of the scatter matrix</span>
0057 S2 = R(1:3,4:5);  <span class="comment">% combined part of the scatter matrix</span>
0058 S3 = R(4:5,4:5);  <span class="comment">% linear part of the scatter matrix</span>
0059 T = -(S3 \ S2');  <span class="comment">% for getting a2 from a1</span>
0060 M = S1 + S2 * T;  <span class="comment">% reduced scatter matrix</span>
0061 
0062 p = <a href="parabolafit_directm.html" class="code" title="function theta = parabolafit_directm(M)">parabolafit_directm</a>(M);
0063 
0064 <span class="comment">% recover parabola coefficients</span>
0065 p = [ eye(3,3) ; T ] * p;
0066 
0067 <span class="comment">% unnormalize noise magnitude</span>
0068 mu = mu / (sigma_x^2 + sigma_y^2);  <span class="comment">% normalize to noise parameter variance magnitude</span>
0069 
0070 <span class="comment">% unnormalize model parameter vector</span>
0071 p = [ p ; -mZ * p ];
0072 
0073 p = <span class="keyword">...</span>
0074 [ p(1)*sy*sy <span class="keyword">...</span>
0075 ; p(2)*sx*sy <span class="keyword">...</span>
0076 ; p(3)*sx*sx <span class="keyword">...</span>
0077 ; -2*p(1)*sy*sy*mx - p(2)*sx*sy*my + p(4)*sx*sy*sy <span class="keyword">...</span>
0078 ; -p(2)*sx*sy*mx - 2*p(3)*sx*sx*my + p(5)*sx*sx*sy <span class="keyword">...</span>
0079 ; p(1)*sy*sy*mx*mx + p(2)*sx*sy*mx*my + p(3)*sx*sx*my*my - p(4)*sx*sy*sy*mx - p(5)*sx*sx*sy*my + p(6)*sx*sx*sy*sy <span class="keyword">...</span>
0080 ];</pre></div>
<hr><address>Generated on Tue 10-Jul-2018 15:03:35 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>