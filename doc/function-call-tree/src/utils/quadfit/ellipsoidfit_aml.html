<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ellipsoidfit_aml</title>
  <meta name="keywords" content="ellipsoidfit_aml">
  <meta name="description" content="Approximated maximum likelihood fit of ellipsoids.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # src --><!-- ../menu.html utils --><!-- menu.html quadfit -->
<h1>ellipsoidfit_aml
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>Approximated maximum likelihood fit of ellipsoids.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function theta = ellipsoidfit_aml(x,y,z,sigma) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Approximated maximum likelihood fit of ellipsoids.
 The constraint confines the class of ellipsoids to fit to those whose smallest radius
 is at least half of the largest radius.
 The method is iterative.

 Input arguments:
 x,y,z:
    x, y and z coodinates of 3D points
 sigma (optional):
    noise variance

 Output arguments:
 theta:
    a 10-parameter vector of the algebraic ellipsoid fit with
    p(1)*x^2 + p(2)*x*y + p(3)*y^2 + p(4)*x + p(5)*y + p(6) = 0</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../src/@y/y.html" class="code" title="">y</a>	</li><li><a href="ellipsoidfit_direct.html" class="code" title="function p = ellipsoidfit_direct(x,y,z)">ellipsoidfit_direct</a>	Direct least squares fitting of ellipsoids under the constraint 4J - I^2 > 0.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="example_ellipsoidfit1.html" class="code" title="function example_ellipsoidfit1">example_ellipsoidfit1</a>	Demonstration of various ellipsoid fits.</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function theta = ellipsoidfit_aml(x,y,z,sigma)</a>
0002 <span class="comment">% Approximated maximum likelihood fit of ellipsoids.</span>
0003 <span class="comment">% The constraint confines the class of ellipsoids to fit to those whose smallest radius</span>
0004 <span class="comment">% is at least half of the largest radius.</span>
0005 <span class="comment">% The method is iterative.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Input arguments:</span>
0008 <span class="comment">% x,y,z:</span>
0009 <span class="comment">%    x, y and z coodinates of 3D points</span>
0010 <span class="comment">% sigma (optional):</span>
0011 <span class="comment">%    noise variance</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Output arguments:</span>
0014 <span class="comment">% theta:</span>
0015 <span class="comment">%    a 10-parameter vector of the algebraic ellipsoid fit with</span>
0016 <span class="comment">%    p(1)*x^2 + p(2)*x*y + p(3)*y^2 + p(4)*x + p(5)*y + p(6) = 0</span>
0017 
0018 <span class="comment">% Copyright 2011 Levente Hunyadi</span>
0019 
0020 narginchk(3,3);
0021 validateattributes(x, {<span class="string">'numeric'</span>}, {<span class="string">'real'</span>,<span class="string">'nonempty'</span>,<span class="string">'vector'</span>});
0022 validateattributes(<a href="../../../src/@y/y.html" class="code" title="">y</a>, {<span class="string">'numeric'</span>}, {<span class="string">'real'</span>,<span class="string">'nonempty'</span>,<span class="string">'vector'</span>});
0023 validateattributes(z, {<span class="string">'numeric'</span>}, {<span class="string">'real'</span>,<span class="string">'nonempty'</span>,<span class="string">'vector'</span>});
0024 x = x(:);
0025 <a href="../../../src/@y/y.html" class="code" title="">y</a> = <a href="../../../src/@y/y.html" class="code" title="">y</a>(:);
0026 z = z(:);
0027 <span class="keyword">if</span> nargin &lt; 4
0028     sigma = 1;
0029 <span class="keyword">else</span>
0030     validateattributes(sigma, {<span class="string">'numeric'</span>}, {<span class="string">'positive'</span>,<span class="string">'scalar'</span>});
0031 <span class="keyword">end</span>
0032 
0033 C = diag(repmat(sigma, 1, 3));
0034 X = zeros(10,10);
0035 
0036 theta = <a href="ellipsoidfit_direct.html" class="code" title="function p = ellipsoidfit_direct(x,y,z)">ellipsoidfit_direct</a>(x,<a href="../../../src/@y/y.html" class="code" title="">y</a>,z);
0037 theta2 = ones(10,1) / norm(ones(10,1));
0038 
0039 <span class="keyword">while</span> norm(theta2 - theta) &gt; 1e-3
0040     theta2 = theta;  <span class="comment">% value from previous iteration</span>
0041     
0042     <span class="keyword">for</span> i = 1 : numel(x)
0043         vi = [ x(i).^2; <a href="../../../src/@y/y.html" class="code" title="">y</a>(i).^2; z(i).^2; <a href="../../../src/@y/y.html" class="code" title="">y</a>(i).*z(i); x(i).*z(i); x(i).*<a href="../../../src/@y/y.html" class="code" title="">y</a>(i); x(i); <a href="../../../src/@y/y.html" class="code" title="">y</a>(i); z(i); 1 ];
0044         Ai = vi * vi';
0045         dvi = <span class="keyword">...</span>
0046         [ 2*x(i), 0, 0, 0, z(i), <a href="../../../src/@y/y.html" class="code" title="">y</a>(i), 1, 0, 0, 0 <span class="keyword">...</span>
0047         ; 0, 2*<a href="../../../src/@y/y.html" class="code" title="">y</a>(i), 0, z(i), 0, x(i), 0, 1, 0, 0 <span class="keyword">...</span>
0048         ; 0, 0, 2*z(i), <a href="../../../src/@y/y.html" class="code" title="">y</a>(i), x(i), 0, 0, 0, 1, 0 <span class="keyword">...</span>
0049         ]';
0050         Bi = dvi * C * dvi';
0051 
0052         Xi = Ai / (theta'*Bi*theta) + (theta'*Ai*theta) / (theta'*Bi*theta)^2 * Bi;
0053         X = X + Xi;
0054     <span class="keyword">end</span>
0055     
0056     <span class="keyword">if</span> 0
0057         Q = X;
0058     <span class="keyword">else</span>
0059         T = 2 / (theta'*Bi*theta)^2 * (Ai*(theta*theta')*Bi + Bi*(theta*theta')*Ai - 2 * (theta'*Ai*theta) / (theta'*Bi*theta) * Bi*(theta*theta')*Bi);
0060         Ht = 2 * (X - T);
0061         
0062         At = Pt * Ht * (2*(theta*theta') - norm(theta)^2 * eye(10,10));
0063         Bt = norm(theta)^2 / norm(at)^2;
0064         Ct = 0;
0065         
0066         Z = At + Bt + Ct;
0067         Q = Z'*Z;
0068     <span class="keyword">end</span>
0069 
0070     [Theta,Lambda] = eig(X);
0071     [~,ix] = min(abs(diag(Lambda)));  <span class="comment">% eigenvalue closest to zero in absolute value</span>
0072     theta = Theta(:,ix);
0073     [~,j] = max(abs(theta));  <span class="comment">% index of maximum absolute value component</span>
0074     theta = theta * sign(theta(j));
0075 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 10-Jul-2018 15:03:35 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>