<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ellipsoidfit_direct</title>
  <meta name="keywords" content="ellipsoidfit_direct">
  <meta name="description" content="Direct least squares fitting of ellipsoids under the constraint 4J - I^2 &gt; 0.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # src --><!-- ../menu.html utils --><!-- menu.html quadfit -->
<h1>ellipsoidfit_direct
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>Direct least squares fitting of ellipsoids under the constraint 4J - I^2 &gt; 0.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function p = ellipsoidfit_direct(x,y,z) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Direct least squares fitting of ellipsoids under the constraint 4J - I^2 &gt; 0.
 The constraint confines the class of ellipsoids to fit to those whose smallest radius
 is at least half of the largest radius.

 Input arguments:
 x,y,z;
    x, y and z coodinates of 3D points

 Output arguments:
 p:
    a 10-parameter vector of the algebraic ellipsoid fit

 References:
 Qingde Li and John G. Griffiths, &quot;Least Squares Ellipsoid Specific Fitting&quot;,
    Proceedings of the Geometric Modeling and Processing, 2004.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../src/@S/S.html" class="code" title="">S</a>	</li><li><a href="../../../src/@y/y.html" class="code" title="">y</a>	</li><li><a href="gsvd_min.html" class="code" title="function [p, s] = gsvd_min(d, c)">gsvd_min</a>	Singular vector belonging to smallest singular value.</li><li><a href="plot_ellipsoid_im.html" class="code" title="function plot_ellipsoid_im(p,varargin)">plot_ellipsoid_im</a>	Plot ellipsoid specified with implicit parameters.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="ellipsoidfit_aml.html" class="code" title="function theta = ellipsoidfit_aml(x,y,z,sigma)">ellipsoidfit_aml</a>	Approximated maximum likelihood fit of ellipsoids.</li><li><a href="example_ellipsoidfit1.html" class="code" title="function example_ellipsoidfit1">example_ellipsoidfit1</a>	Demonstration of various ellipsoid fits.</li><li><a href="example_ellipsoidfit2.html" class="code" title="function example_ellipsoidfit2">example_ellipsoidfit2</a>	Demonstration of fits to various special ellipsoids.</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function p = ellipsoidfit_direct(x,y,z)</a>
0002 <span class="comment">% Direct least squares fitting of ellipsoids under the constraint 4J - I^2 &gt; 0.</span>
0003 <span class="comment">% The constraint confines the class of ellipsoids to fit to those whose smallest radius</span>
0004 <span class="comment">% is at least half of the largest radius.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Input arguments:</span>
0007 <span class="comment">% x,y,z;</span>
0008 <span class="comment">%    x, y and z coodinates of 3D points</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Output arguments:</span>
0011 <span class="comment">% p:</span>
0012 <span class="comment">%    a 10-parameter vector of the algebraic ellipsoid fit</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% References:</span>
0015 <span class="comment">% Qingde Li and John G. Griffiths, &quot;Least Squares Ellipsoid Specific Fitting&quot;,</span>
0016 <span class="comment">%    Proceedings of the Geometric Modeling and Processing, 2004.</span>
0017 
0018 <span class="comment">% Copyright 2011 Levente Hunyadi</span>
0019 
0020 narginchk(3,3);
0021 validateattributes(x, {<span class="string">'numeric'</span>}, {<span class="string">'real'</span>,<span class="string">'nonempty'</span>,<span class="string">'vector'</span>});
0022 validateattributes(<a href="../../../src/@y/y.html" class="code" title="">y</a>, {<span class="string">'numeric'</span>}, {<span class="string">'real'</span>,<span class="string">'nonempty'</span>,<span class="string">'vector'</span>});
0023 validateattributes(z, {<span class="string">'numeric'</span>}, {<span class="string">'real'</span>,<span class="string">'nonempty'</span>,<span class="string">'vector'</span>});
0024 x = x(:);
0025 <a href="../../../src/@y/y.html" class="code" title="">y</a> = <a href="../../../src/@y/y.html" class="code" title="">y</a>(:);
0026 z = z(:);
0027 
0028 <span class="comment">% build design matrix</span>
0029 D = [ x.^2, y.^2, z.^2, 2*y.*z, 2*x.*z, 2*x.*<a href="../../../src/@y/y.html" class="code" title="">y</a>, 2*x, 2*<a href="../../../src/@y/y.html" class="code" title="">y</a>, 2*z, ones(numel(x),1) ];
0030 
0031 <span class="comment">% build scatter matrix</span>
0032 <a href="../../../src/@S/S.html" class="code" title="">S</a> = D'*D;
0033 
0034 <span class="comment">% build 10x10 constraint matrix</span>
0035 k = 4;  <span class="comment">% to ensure that the parameter vector always defines an ellipse</span>
0036 C1 = [ 0 k k ; k 0 k ; k k 0 ] / 2 - 1;
0037 C2 = -k * eye(3,3);
0038 C3 = zeros(4,4);
0039 
0040 method = <span class="string">'evd'</span>;
0041 <span class="keyword">switch</span> method
0042     <span class="keyword">case</span> <span class="string">'evd'</span>
0043         C = blkdiag(C1,C2,C3);
0044 
0045         <span class="comment">% solve eigensystem</span>
0046         [gevec, geval] = eig(<a href="../../../src/@S/S.html" class="code" title="">S</a>,C);
0047         geval = diag(geval);
0048 
0049         <span class="comment">% extract eigenvector corresponding to the unique positive eigenvalue</span>
0050         flt = geval &gt; 0 &amp; ~isinf(geval);
0051         <span class="keyword">switch</span> nnz(flt)
0052             <span class="keyword">case</span> 0
0053                 <span class="comment">% degenerate case; single positive eigenvalue becomes near-zero negative eigenvalue</span>
0054                 <span class="comment">% due to round-off error</span>
0055                 [~,ix] = min(abs(geval));
0056                 v = gevec(:,ix);
0057             <span class="keyword">case</span> 1
0058                 <span class="comment">% regular case</span>
0059                 v = gevec(:,flt);
0060             <span class="keyword">otherwise</span>
0061                 <span class="comment">% degenerate case; several positive eigenvalues appear</span>
0062                 [~,ix] = min(abs(geval));
0063                 v = gevec(:,ix);
0064         <span class="keyword">end</span>
0065     <span class="keyword">case</span> <span class="string">'evdinv'</span>
0066         C = blkdiag(C1,C2);
0067 
0068         <span class="comment">% solve generalized eigensystem</span>
0069         S11 = <a href="../../../src/@S/S.html" class="code" title="">S</a>(1:6,1:6);
0070         S12 = <a href="../../../src/@S/S.html" class="code" title="">S</a>(1:6,7:10);
0071         S22 = <a href="../../../src/@S/S.html" class="code" title="">S</a>(7:10,7:10);
0072 
0073         <span class="comment">% extract eigenvector corresponding to the unique positive eigenvalue</span>
0074         [gevec, geval] = eig(S11-S12/S22*S12', C);
0075         geval = diag(geval);
0076 
0077         <span class="comment">% compute parameters</span>
0078         v1 = gevec(:, geval &gt; 0 &amp; ~isinf(geval)); 
0079         v2 = -S22\S12'*v1;
0080         v = [v1; v2];
0081     <span class="keyword">case</span> <span class="string">'svd'</span>
0082         C = blkdiag(C1,C2,C3);
0083         [CV,CD] = eig(C);
0084 
0085         CC = sqrt(CD)*CV';  <span class="comment">% complex result</span>
0086         v = <a href="gsvd_min.html" class="code" title="function [p, s] = gsvd_min(d, c)">gsvd_min</a>(D,CC);
0087         v = real(v);  <span class="comment">% discard imaginary part with small magnitude</span>
0088 <span class="keyword">end</span>
0089 
0090 p = zeros(size(v));
0091 p(1:3) = v(1:3);
0092 p(4:6) = 2*v(6:-1:4);  <span class="comment">% exchange order of y*z, x*z, x*y to x*y, x*z, y*z</span>
0093 p(7:9) = 2*v(7:9);
0094 p(10) = v(10);
0095 
0096 <span class="keyword">if</span> nargout == 0
0097     hold on;
0098     plot3(x,<a href="../../../src/@y/y.html" class="code" title="">y</a>,z,<span class="string">'.'</span>);
0099     axis equal;
0100     <a href="plot_ellipsoid_im.html" class="code" title="function plot_ellipsoid_im(p,varargin)">plot_ellipsoid_im</a>(p,x,<a href="../../../src/@y/y.html" class="code" title="">y</a>,z);
0101     hold off;
0102 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 10-Jul-2018 15:03:35 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>